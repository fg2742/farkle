<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Cribbage Simulator</title>

<!-- iPhone Home Screen settings -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="">

<style>
  body { font-family: Arial, sans-serif; padding: 10px; background-color: #0B5E1F; color: #fff; margin:0;}
  h2 { text-align:center; margin:0 0 10px 0; color:#fff;}
  button { margin: 5px 0; padding: 12px 0; font-size: 18px; width: 100%; border-radius: 8px; cursor: pointer; }
  button:hover { background-color: #eee; }
  #handsContainer { overflow-x: auto; margin-top: 10px; }
  table { border-collapse: collapse; width: 100%; background-color: #fff; color: #000; min-width: 400px; }
  td, th { border: 1px solid #ccc; padding: 8px 6px; text-align: center; font-size: 18px; }
  .red { color: red; }
  .starter { background-color: #ffd966; padding: 4px 6px; border-radius: 4px; }
  @media (max-width: 500px) {
    td, th { font-size: 16px; padding: 6px 4px; }
    button { font-size: 16px; padding: 10px 0; }
  }
</style>
</head>
<body>

<h2>Cribbage Multi-Hand Simulator</h2>

<button id="dealHandsBtn">Deal 5 Hands</button>

<div id="handsContainer"></div>

<script>
const suits = ['♠', '♥', '♦', '♣'];
const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
let dealtHands = []; // array of objects {hand: [4], starter: card, scoreShown: bool}

// Utilities
function parseCard(cardStr) {
  const match = cardStr.match(/^(10|[A2-9JQK])(.+)$/);
  return { rank: match[1], suit: match[2] };
}

function scoreCribbageHand(hand, starter) {
  const fullHand = [...hand, starter];
  const rankValues = { A:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:10,Q:10,K:10 };
  const cards = fullHand.map(c => parseCard(c));

  let fifteens = 0;
  const values = cards.map(c => rankValues[c.rank]);
  for (let mask = 1; mask < (1 << values.length); mask++) {
    let sum = 0;
    for (let i = 0; i < values.length; i++) if (mask & (1 << i)) sum += values[i];
    if (sum === 15) fifteens += 2;
  }

  let pairs = 0;
  for (let i = 0; i < cards.length; i++)
    for (let j = i+1; j < cards.length; j++)
      if (cards[i].rank === cards[j].rank) pairs += 2;

  const rankOrder = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const rankCounts = Object.fromEntries(rankOrder.map(r=>[r,0]));
  cards.forEach(c=>rankCounts[c.rank]++);
  let runs = 0;
  for (let i=0;i<=rankOrder.length-3;i++) {
    let len=0;
    while(i+len<rankOrder.length && rankCounts[rankOrder[i+len]]>0) len++;
    if(len>=3){
      const subset=rankOrder.slice(i,i+len);
      const mult=subset.reduce((m,r)=>m*rankCounts[r],1);
      runs+=len*mult;
    }
  }

  const handSuits = hand.map(c=>parseCard(c).suit);
  const starterSuit = parseCard(starter).suit;
  let flush=0;
  if(handSuits.every(s=>s===handSuits[0])) flush=(starterSuit===handSuits[0]?5:4);

  const hisNobs = hand.some(c=>{ const p=parseCard(c); return p.rank==='J' && p.suit===starterSuit })?1:0;

  const total = fifteens + pairs + runs + flush + hisNobs;
  return { fifteens, pairs, runs, flush, hisNobs, total };
}

function colorCard(c) {
  const suit = c.slice(-1);
  return (suit==='♥'||suit==='♦')?`<span class="red">${c}</span>`:c;
}

// Deal multiple hands
document.getElementById('dealHandsBtn').addEventListener('click', () => {
  dealtHands = [];
  const deck = [];
  for (const suit of suits) for (const rank of ranks) deck.push(rank+suit);

  for (let i = deck.length-1; i>0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }

  let index=0;
  for (let h=0; h<5; h++) {
    const hand = deck.slice(index,index+4);
    const starter = deck[index+4];
    dealtHands.push({hand, starter, scoreShown: false});
    index +=5;
  }

  displayHands();
});

function displayHands() {
  let html = `<table><tr><th>Hand #</th><th>Cards</th><th>Action</th></tr>`;
  dealtHands.forEach((obj, i) => {
    const cardsHtml = obj.hand.map(colorCard).join(', ') + ' | <span class="starter">'+colorCard(obj.starter)+'</span>';
    const scoreHtml = obj.scoreShown ? scoreCribbageHand(obj.hand, obj.starter).total : '';
    html += `<tr>
      <td>${i+1}</td>
      <td>${cardsHtml}</td>
      <td><button onclick="showScore(${i})">${scoreHtml?'Score: '+scoreHtml:'Show Score'}</button></td>
    </tr>`;
  });
  html += '</table>';
  document.getElementById('handsContainer').innerHTML = html;
}

function showScore(index) {
  dealtHands[index].scoreShown = true;
  displayHands();
}
</script>
</body>
</html>
